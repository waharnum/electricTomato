<!DOCTYPE html>
<html>
<head>
<title>Electric Tomato</title>
<script>window.$ = window.jQuery = require('jquery');</script>
</head>
<body>
    <h1>Countdown</h1>
    <div id="countdown"></div>
    <form>
        <div class="buttonContainer"><button id="pomodoro">Pomodoro</button></div>
        <div class="buttonContainer"><button id="shortBreak">Short Break</button></div>
        <div class="buttonContainer"><button id="longBreak">Long Break</button></div>
        <div class="buttonContainer"><button id="pauseResume">Pause / Resume</button></div>
    </form>

  <script>
    // Global timerState management object
    var timerState = {
        timerId: null,
        currentSeconds: null,
        isPaused: false
    };

    var startTimer = function (seconds) {
        window.clearTimeout(timerState.timerId);
        var countdown = $("#countdown");
        countdown.text(formatTimer(seconds));
        timerState.currentSeconds = seconds;
        timerState.timerId = window.setTimeout(decreaseTimer, 1000);
    };

    var pauseTimer = function () {
        window.clearTimeout(timerState.timerId);
        timerState.isPaused = true;
    };

    var resumeTimer = function () {
        startTimer(timerState.currentSeconds);
        timerState.isPaused = false;
    };

    var bindTimerClick = function (id, seconds) {
        $("#"+id).click(function (e) {
            startTimer(seconds);
            e.preventDefault();
        });
    };

    var bindPauseClick = function () {
        $("#pauseResume").click(function (e) {
            console.log(timerState.isPaused);
            if(! timerState.isPaused) {
                console.log("pause")
                pauseTimer();
            }
            else if(timerState.isPaused) {
                console.log("resume")
                resumeTimer();
            }
            e.preventDefault();
        });
    };

    // Given a number of seconds, returns a timer minutes/seconds representation
    var formatTimer = function (seconds) {
        var minutes = Math.floor(seconds / 60);
        var seconds = seconds % 60;
        var displayedSeconds = seconds === 0 ? "00" : seconds;
        return minutes + ":" + displayedSeconds;
    };

    function decreaseTimer() {
        var countdown = $("#countdown");
        timerState.currentSeconds--;
        countdown.text(formatTimer(timerState.currentSeconds));
        if(timerState.currentSeconds > 0) {
            timerState.timerId = window.setTimeout(decreaseTimer, 1000)
        } else {
            new Notification("Countdown Complete", {title: "Countdown Complete", body: "The countdown is complete"})
        }
    };

    bindTimerClick("pomodoro", 25*60);
    bindTimerClick("shortBreak", 5*60);
    bindTimerClick("longBreak", 15*60);
    bindPauseClick();

  </script>
</body>
</html>
